<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اكتشف مستقبلك المهني | اختبار التوظيف المثالي</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@160..700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#7c3aed',
                        accent: '#a78bfa',
                        dark: '#1e1b4b',
                        light: '#f5f3ff'
                    },
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap');


body {
  font-family: 'Tajawal', sans-serif;
  position: relative;
  z-index: 0;
  min-height: 100vh;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('https://i.imgur.com/5EQyhT4.png');
  background-size: cover;
  background-position: center top;
  background-repeat: no-repeat;
  background-attachment: fixed;
  z-index: -1;
  opacity: 1; /* you can lower this for subtle background */
}




        
            
        
        
        .gradient-bg {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        
        .card-glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-track {
            height: 12px;
            background-color: #e9d5ff;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-thumb {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
            border-radius: 6px;
            transition: width 0.5s cubic-bezier(0.65, 0, 0.35, 1);
        }
        
        .option-pill {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e9d5ff;
        }
        
        .option-pill:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.2);
            border-color: #a78bfa;
        }
        
        .option-pill.selected {
            background-color: #ede9fe;
            border-color: #8b5cf6;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
        }
        
        .job-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .job-card:hover {
            transform: translateY(-5px);
        }
        
        .top-job {
            position: relative;
            overflow: hidden;
        }
        
        .top-job::after {
            content: "الأفضل لك";
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: #4f46e5;
            color: white;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .ai-processing {
            position: relative;
            width: 120px;
            height: 120px;
        }
        
        .ai-processing .circle {
            position: absolute;
            border-radius: 50%;
            border: 8px solid transparent;
            mix-blend-mode: multiply;
            animation: rotate 3s linear infinite;
        }
        
        .ai-processing .circle:nth-child(1) {
            width: 100%;
            height: 100%;
            border-top-color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        
        .ai-processing .circle:nth-child(2) {
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
            border-left-color: #7c3aed;
            border-right-color: #7c3aed;
            animation-direction: reverse;
            animation-duration: 4s;
        }
        
        .ai-processing .circle:nth-child(3) {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            border-top-color: #a78bfa;
            border-bottom-color: #a78bfa;
            animation-duration: 5s;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #ddd6fe;
        }
        
        .input-field:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7c3aed, #4f46e5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }
        
        .btn-secondary {
            background-color: white;
            color: #4f46e5;
            border: 2px solid #ddd6fe;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-secondary:hover {
            background-color: #f5f3ff;
            border-color: #a78bfa;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div id="app" class="max-w-4xl mx-auto px-4 py-8 md:py-12">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="fade-in">
            <div class="text-center py-8 md:py-12">
                <div class="relative mx-auto w-32 h-32 mb-8">
                    <div class="absolute inset-0 bg-white rounded-full shadow-lg flex items-center justify-center floating">
                        <i class="fas fa-user-tie text-5xl text-primary"></i>
                    </div>
                    <div class="absolute -inset-4 rounded-full bg-primary opacity-10 blur-lg"></div>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold text-[#1D0EC4] mb-6" style="font-family: 'Readex Pro', sans-serif;">
                    أختبار Smart-Track للتوجيه المهني
                </h1>
                <p class="text-xl text-[#A8E4ED] mb-8 max-w-2xl mx-auto leading-relaxed">
                    اختبار ذكي يساعدك في تحديد المسار الوظيفي الأمثل بناءً على مهاراتك واهتماماتك وشخصيتك
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4 mt-10">
                    <button onclick="showUserInfo()" class="btn-primary text-white font-bold py-4 px-8 rounded-xl text-lg">
                        ابدأ الاختبار الآن <i class="fas fa-arrow-left ml-2"></i>
                    </button>
                    <button class="btn-secondary font-bold py-4 px-8 rounded-xl text-lg">
                        تعرف على المزيد
                    </button>
                </div>
                
                <div class="mt-16 pt-8 border-t border-gray-200">
                    <h3 class="text-lg font-medium text-gray-600 mb-6">آراء المشاركين</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mr-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold">أحمد</h4>
                                    <div class="flex text-yellow-400 text-sm">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm">ساعدني الاختبار في اكتشاف مسار لم أكن أتوقعه، أشكركم على هذه الأداة الرائعة!</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold">سارة</h4>
                                    <div class="flex text-yellow-400 text-sm">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm">النتائج كانت دقيقة جداً وتطابق توقعاتي، أوصي بهذا الاختبار للجميع</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 mr-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold">خالد</h4>
                                    <div class="flex text-yellow-400 text-sm">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="far fa-star"></i>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm">تجربة ممتعة ومفيدة، خاصة للذين ما زالوا يبحثون عن شغفهم</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Info Screen -->
        <div id="user-info-screen" class="hidden fade-in">
            <div class="card-glass rounded-2xl shadow-xl p-6 md:p-8">
                <div class="flex items-center mb-8">
                    <button onclick="showScreen('welcome')" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 mr-4">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-primary">معلوماتك الشخصية</h2>
                </div>
                
                <form id="user-info-form" class="space-y-6">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">الاسم الكامل</label>
                        <input type="text" id="full-name" required 
                               class="input-field w-full px-5 py-3 rounded-xl focus:outline-none">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">العمر</label>
                            <input type="number" id="age" required 
                                   class="input-field w-full px-5 py-3 rounded-xl focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">تاريخ الميلاد</label>
                            <input type="date" id="dob" required 
                                   class="input-field w-full px-5 py-3 rounded-xl focus:outline-none">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">المستوى التعليمي</label>
                        <select id="education" required 
                                class="input-field w-full px-5 py-3 rounded-xl focus:outline-none">
                            <option value="">اختر مستوى تعليمي</option>
                            <option value="ثانوي">ثانوي</option>
                            <option value="دبلوم">دبلوم</option>
                            <option value="بكالوريوس">بكالوريوس</option>
                            <option value="ماجستير">ماجستير</option>
                            <option value="دكتوراه">دكتوراه</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">رمز الاختبار (اختياري)</label>
                        <input type="text" id="test-code" 
                               class="input-field w-full px-5 py-3 rounded-xl focus:outline-none"
                               placeholder="إذا كان لديك رمز خاص">
                    </div>
                    
                    <div class="pt-4">
                        <button type="button" onclick="startTest()" 
                                class="btn-primary text-white font-bold py-4 px-8 rounded-xl text-lg w-full">
                            بدء الاختبار <i class="fas fa-play ml-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Test Screen -->
        <div id="test-screen" class="hidden fade-in">
            <div class="card-glass rounded-2xl shadow-xl overflow-hidden">
                <!-- Progress Bar -->
                <div class="px-6 pt-6">
                    <div class="flex justify-between items-center mb-2">
                        <span id="question-number" class="text-gray-600 font-medium">السؤال 1 من 30</span>
                        <span id="progress-text" class="text-primary font-bold">0%</span>
                    </div>
                    <div class="progress-track w-full">
                        <div id="progress-fill" class="progress-thumb" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Question -->
                <div class="px-6 py-8">
                    <div class="flex items-start mb-8">
                        <div class="flex-shrink-0 w-12 h-12 rounded-xl gradient-bg flex items-center justify-center text-white text-xl font-bold mr-4">
                            <span id="current-question-number">1</span>
                        </div>
                        <h3 id="question-text" class="text-2xl font-bold leading-relaxed">
                            ما هو المجال الذي تشعر بالحماس عند التفكير فيه؟
                        </h3>
                    </div>
                    
                    <!-- Options -->
                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="option-pill bg-white rounded-xl p-5 cursor-pointer" onclick="selectOption(this, 0)">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 text-primary flex items-center justify-center mr-4">
                                    <i class="fas fa-laptop-code"></i>
                                </div>
                                <p class="font-medium">التكنولوجيا والبرمجة</p>
                            </div>
                        </div>
                        <div class="option-pill bg-white rounded-xl p-5 cursor-pointer" onclick="selectOption(this, 1)">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-4">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <p class="font-medium">الأعمال والتسويق</p>
                            </div>
                        </div>
                        <div class="option-pill bg-white rounded-xl p-5 cursor-pointer" onclick="selectOption(this, 2)">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-4">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                                <p class="font-medium">التعليم والتدريس</p>
                            </div>
                        </div>
                        <div class="option-pill bg-white rounded-xl p-5 cursor-pointer" onclick="selectOption(this, 3)">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center mr-4">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <p class="font-medium">الفن والإبداع</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="hidden fade-in">
            <div class="card-glass rounded-2xl shadow-xl p-8 md:p-12 text-center">
                <div class="ai-processing mx-auto mb-8">
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold text-primary mb-4">جاري تحليل نتائجك</h2>
                <p class="text-gray-600 text-lg mb-8 max-w-lg mx-auto leading-relaxed">
                    نظامنا الذكي يقوم بتحليل إجاباتك بدقة للعثور على أفضل الوظائف التي تتوافق مع شخصيتك ومهاراتك
                </p>
                
                <div class="max-w-md mx-auto">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm text-gray-600">0%</span>
                        <span id="ai-progress-text" class="text-sm text-primary font-bold">0%</span>
                    </div>
                    <div class="progress-track w-full">
                        <div id="ai-progress" class="progress-thumb" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <p class="text-gray-500 text-sm">
                        <i class="fas fa-info-circle text-primary mr-2"></i>
                        النتائج تعتمد على تحليل أكثر من 100 عامل لضمان الدقة
                    </p>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden fade-in">
            <div class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary mb-4">
                    نتائج اختبارك المهني
                </h1>
                <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                    بناءً على تحليل إجاباتك، إليك أفضل الوظائف التي تناسب شخصيتك ومهاراتك
                </p>
            </div>
            
            <div id="results-container" class="space-y-6">
                <!-- Top Match -->
                <div class="job-card top-job bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="flex flex-col md:flex-row">
                        <div class="w-full md:w-1/3 bg-gradient-to-br from-primary to-secondary p-8 flex flex-col items-center justify-center">
                            <div class="w-20 h-20 rounded-2xl bg-white bg-opacity-20 flex items-center justify-center text-white mb-6">
                                <i class="fas fa-laptop-code text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-2">مطور برمجيات</h3>
                            <p class="text-white text-opacity-80 text-sm">التكنولوجيا والبرمجة</p>
                        </div>
                        <div class="w-full md:w-2/3 p-8">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 rounded-full bg-purple-100 text-primary flex items-center justify-center mr-4">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg">التوافق: <span class="text-primary">95%</span></h4>
                                    <p class="text-gray-500 text-sm">أعلى درجة توافق</p>
                                </div>
                            </div>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                هذا المسار يناسب مهاراتك التحليلية وحبك للتحديات التقنية. ستجد في هذا المجال فرصاً كبيرة للإبداع والتطوير المستمر مع رواتب ممتازة وفرص عمل عالمية.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-3 py-1 bg-purple-100 text-primary rounded-full text-sm">تحليل المشكلات</span>
                                <span class="px-3 py-1 bg-purple-100 text-primary rounded-full text-sm">التفكير المنطقي</span>
                                <span class="px-3 py-1 bg-purple-100 text-primary rounded-full text-sm">الإبداع التقني</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Second Match -->
                <div class="job-card bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="flex flex-col md:flex-row">
                        <div class="w-full md:w-1/3 bg-gradient-to-br from-blue-600 to-blue-400 p-8 flex flex-col items-center justify-center">
                            <div class="w-20 h-20 rounded-2xl bg-white bg-opacity-20 flex items-center justify-center text-white mb-6">
                                <i class="fas fa-chart-bar text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-2">محلل بيانات</h3>
                            <p class="text-white text-opacity-80 text-sm">التحليل والإحصاء</p>
                        </div>
                        <div class="w-full md:w-2/3 p-8">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-4">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg">التوافق: <span class="text-blue-600">88%</span></h4>
                                    <p class="text-gray-500 text-sm">بديل ممتاز</p>
                                </div>
                            </div>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                مهاراتك في التفكير المنطقي وتحليل المشكلات تجعلك مرشحاً مثالياً لعالم البيانات والتحليل الإحصائي. هذا المجال يشهد نمواً كبيراً مع تزايد أهمية البيانات في اتخاذ القرارات.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-sm">تحليل البيانات</span>
                                <span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-sm">الانتباه للتفاصيل</span>
                                <span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-sm">التفكير النقدي</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Third Match -->
                <div class="job-card bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="flex flex-col md:flex-row">
                        <div class="w-full md:w-1/3 bg-gradient-to-br from-green-600 to-green-400 p-8 flex flex-col items-center justify-center">
                            <div class="w-20 h-20 rounded-2xl bg-white bg-opacity-20 flex items-center justify-center text-white mb-6">
                                <i class="fas fa-bullhorn text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-2">مدير تسويق رقمي</h3>
                            <p class="text-white text-opacity-80 text-sm">التسويق والإعلان</p>
                        </div>
                        <div class="w-full md:w-2/3 p-8">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-4">
                                    <i class="fas fa-ad"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg">التوافق: <span class="text-green-600">82%</span></h4>
                                    <p class="text-gray-500 text-sm">خيار جيد</p>
                                </div>
                            </div>
                            <p class="text-gray-600 mb-6 leading-relaxed">
                                مهاراتك في التواصل والفهم النفسي تجعلك مرشحاً ممتازاً لإدارة الحملات التسويقية وبناء العلامات التجارية. هذا المجال مثالي لمن يحب الإبداع مع الجانب التحليلي.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-3 py-1 bg-green-100 text-green-600 rounded-full text-sm">الإبداع</span>
                                <span class="px-3 py-1 bg-green-100 text-green-600 rounded-full text-sm">التواصل</span>
                                <span class="px-3 py-1 bg-green-100 text-green-600 rounded-full text-sm">التحليل</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-12 space-y-4">
                <button id="download-pdf-btn" onclick="downloadResults()" class="btn-primary text-white font-bold py-4 px-8 rounded-xl text-lg inline-flex items-center">
                    <i class="fas fa-download ml-2"></i> تحميل النتائج كملف PDF
                </button>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button onclick="restartTest()" class="btn-secondary font-bold py-4 px-8 rounded-xl text-lg">
                        إعادة الاختبار <i class="fas fa-redo ml-2"></i>
                    </button>
                    <button class="bg-white border border-gray-200 font-bold py-4 px-8 rounded-xl text-lg shadow-sm hover:bg-gray-50 transition">
                        مشاركة النتائج <i class="fas fa-share-alt ml-2"></i>
                    </button>
                </div>
            </div>
            
            <div class="mt-16 pt-8 border-t border-gray-200">
                <h3 class="text-xl font-bold text-center mb-6">الخطوات التالية</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="w-12 h-12 rounded-xl bg-purple-100 text-primary flex items-center justify-center text-xl mb-4">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h4 class="font-bold mb-2">تطوير المهارات</h4>
                        <p class="text-gray-600 text-sm">دورات تدريبية لتعزيز مهاراتك في المجال الموصى به</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center text-xl mb-4">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h4 class="font-bold mb-2">فرص عمل</h4>
                        <p class="text-gray-600 text-sm">تصفح الوظائف الشاغرة في مجال تخصصك</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="w-12 h-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center text-xl mb-4">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h4 class="font-bold mb-2">استشارة مهنية</h4>
                        <p class="text-gray-600 text-sm">احجز جلسة مع مستشار مهني لمساعدتك في التخطيط</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // App State
        const state = {
            currentScreen: 'welcome',
            currentUser: {},
            currentQuestion: 0,
            answers: new Array(30).fill(null),
            questions: [
                {
                    text: "ما هو المجال الذي تشعر بالحماس عند التفكير فيه؟",
                    options: [
                        {text: "التكنولوجيا والبرمجة", categories: ["tech"]},
                        {text: "الأعمال والتسويق", categories: ["business"]},
                        {text: "التعليم والتدريس", categories: ["education"]},
                        {text: "الفن والإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تفضل قضاء وقت فراغك؟",
                    options: [
                        {text: "حل الألغاز والمشاكل المعقدة", categories: ["tech", "analytical"]},
                        {text: "التخطيط للمشاريع والمهام", categories: ["business", "management"]},
                        {text: "مساعدة الآخرين في التعلم", categories: ["education", "helping"]},
                        {text: "الرسم أو الكتابة أو التمثيل", categories: ["creative", "artistic"]}
                    ]
                },
                {
                    text: "ما هو نوع العمل الذي تجده الأكثر إشباعاً؟",
                    options: [
                        {text: "تطوير البرمجيات أو التطبيقات", categories: ["tech"]},
                        {text: "إدارة الفرق والمشاريع", categories: ["business"]},
                        {text: "تعليم الآخرين مهارات جديدة", categories: ["education"]},
                        {text: "تصميم المنتجات أو الخدمات", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هي مهارتك الأقوى حسب رأيك؟",
                    options: [
                        {text: "التفكير المنطقي والتحليل", categories: ["tech", "analytical"]},
                        {text: "التواصل والإدارة", categories: ["business"]},
                        {text: "التوضيح والشرح", categories: ["education"]},
                        {text: "الإبداع والخيال", categories: ["creative"]}
                    ]
                },
                {
                    text: "أي من هذه الأنشطة تجدها الأكثر متعة؟",
                    options: [
                        {text: "برمجة حلول تقنية جديدة", categories: ["tech"]},
                        {text: "تنظيم فعاليات أو مشاريع", categories: ["business"]},
                        {text: "تدريب أو توجيه الآخرين", categories: ["education"]},
                        {text: "تصميم رسومات أو أعمال فنية", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع المشكلات التي تفضل حلها؟",
                    options: [
                        {text: "مشاكل برمجية أو تقنية", categories: ["tech"]},
                        {text: "تحديات في إدارة الأعمال", categories: ["business"]},
                        {text: "صعوبات في التعلم لدى الآخرين", categories: ["education"]},
                        {text: "عقبات إبداعية في المشاريع", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تصف بيئة العمل المثالية بالنسبة لك؟",
                    options: [
                        {text: "بيئة هادئة مع إمكانية التركيز", categories: ["tech"]},
                        {text: "بيئة نشطة مع تواصل مستمر", categories: ["business"]},
                        {text: "بيئة تعاونية مع تبادل المعرفة", categories: ["education"]},
                        {text: "بيئة مرنة مع حرية الإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو أسلوب التعلم المفضل لديك؟",
                    options: [
                        {text: "التجارب العملية والتطبيق", categories: ["tech"]},
                        {text: "الندوات وورش العمل", categories: ["business"]},
                        {text: "المناقشة مع الآخرين", categories: ["education"]},
                        {text: "المشاهدة والإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هي المهارة التي تحلم بتطويرها؟",
                    options: [
                        {text: "البرمجة والتطوير التقني", categories: ["tech"]},
                        {text: "إدارة المشاريع والأعمال", categories: ["business"]},
                        {text: "التخصص في مجال تعليمي", categories: ["education"]},
                        {text: "المهارات الفنية والإبداعية", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تتعامل مع التحديات الصعبة؟",
                    options: [
                        {text: "بتقسيمها إلى مشاكل فرعية", categories: ["tech"]},
                        {text: "بتخطيط استراتيجية شاملة", categories: ["business"]},
                        {text: "بالبحث عن مساعدة ومشورة", categories: ["education"]},
                        {text: "بالتفكير خارج الصندوق", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو دورك المفضل في الفريق؟",
                    options: [
                        {text: "المطور أو المبرمج", categories: ["tech"]},
                        {text: "المنسق أو المخطط", categories: ["business"]},
                        {text: "المعلم أو المرشد", categories: ["education"]},
                        {text: "المبدع أو الفنان", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو الوقت الذي تكون فيه الأكثر إنتاجية؟",
                    options: [
                        {text: "في ساعات الليل الهادئة", categories: ["tech"]},
                        {text: "خلال النهار مع الفريق", categories: ["business"]},
                        {text: "عند العمل مع الآخرين", categories: ["education"]},
                        {text: "في أوقات الراحة والإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع الأدوات التي تجدها أكثر فائدة؟",
                    options: [
                        {text: "أدوات البرمجة والتطوير", categories: ["tech"]},
                        {text: "برامج الأعمال والإدارة", categories: ["business"]},
                        {text: "منصات التعليم والتدريب", categories: ["education"]},
                        {text: "برامج التصميم والإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تتعامل مع الأخطاء أو الفشل؟",
                    options: [
                        {text: "بتحليل الأسباب التقنية", categories: ["tech"]},
                        {text: "بمراجعة الخطط والأهداف", categories: ["business"]},
                        {text: "بالتعلم من الخبرة", categories: ["education"]},
                        {text: "بالبحث عن حلول إبداعية", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع الإنجازات التي تشعرك بالفخر؟",
                    options: [
                        {text: "تطوير حلول تقنية فعالة", categories: ["tech"]},
                        {text: "تحقيق أهداف أعمال استراتيجية", categories: ["business"]},
                        {text: "مساعدة الآخرين في التعلم", categories: ["education"]},
                        {text: "إنتاج أعمال فنية متميزة", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو المجال الذي تقرأ عنه في وقت فراغك؟",
                    options: [
                        {text: "أحدث التقنيات والبرمجة", categories: ["tech"]},
                        {text: "إدارة الأعمال والاقتصاد", categories: ["business"]},
                        {text: "التعليم والتطوير المهني", categories: ["education"]},
                        {text: "الفن والتصميم", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هي المهارة التي تحظى باحترام زملائك؟",
                    options: [
                        {text: "المهارات التقنية والتحليلية", categories: ["tech"]},
                        {text: "القيادة وإدارة المشاريع", categories: ["business"]},
                        {text: "التواصل والشرح الواضح", categories: ["education"]},
                        {text: "الإبداع والخيال", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تفضل تلقي المعلومات الجديدة؟",
                    options: [
                        {text: "عبر الكود والأمثلة العملية", categories: ["tech"]},
                        {text: "من خلال التقارير والبيانات", categories: ["business"]},
                        {text: "بواسطة المناقشات والحوارات", categories: ["education"]},
                        {text: "من خلال العروض والتصاميم", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع الأهداف التي تحددها لنفسك؟",
                    options: [
                        {text: "أهداف تقنية محددة قابلة للقياس", categories: ["tech"]},
                        {text: "أهداف استراتيجية طويلة المدى", categories: ["business"]},
                        {text: "أهداف تعليمية وتطويرية", categories: ["education"]},
                        {text: "أهداف إبداعية وفنية", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع الكتب التي تفضل قراءتها؟",
                    options: [
                        {text: "كتب البرمجة والتكنولوجيا", categories: ["tech"]},
                        {text: "كتب الأعمال والإدارة", categories: ["business"]},
                        {text: "كتب التعليم والتعلم", categories: ["education"]},
                        {text: "كتب الفن والإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تحل التعارض بين الزملاء؟",
                    options: [
                        {text: "بتحليل المشكلة منطقياً", categories: ["tech"]},
                        {text: "بوساطة واستراتيجية", categories: ["business"]},
                        {text: "بالحوار والتفاهم", categories: ["education"]},
                        {text: "بأفكار إبداعية", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع العمل الذي يجعلك تشعر بالإنجاز؟",
                    options: [
                        {text: "تطوير برامج معقدة", categories: ["tech"]},
                        {text: "تنفيذ خطط أعمال ناجحة", categories: ["business"]},
                        {text: "تعليم مهارات جديدة للآخرين", categories: ["education"]},
                        {text: "إنشاء أعمال فنية", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هي البيئة التي تساعدك على التفكير بشكل أفضل؟",
                    options: [
                        {text: "مكان هادئ مع أدوات تقنية", categories: ["tech"]},
                        {text: "مساحة عمل مشتركة نشطة", categories: ["business"]},
                        {text: "بيئة صفية هادئة", categories: ["education"]},
                        {text: "مكان ملهم بصرياً", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع التقدير الذي تطمح للحصول عليه؟",
                    options: [
                        {text: "الاعتراف التقني والمهني", categories: ["tech"]},
                        {text: "النجاح في الأعمال والمشاريع", categories: ["business"]},
                        {text: "تقدير الطلاب والزملاء", categories: ["education"]},
                        {text: "تقدير الجمهور والنقاد", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تخطط لمستقبلك المهني؟",
                    options: [
                        {text: "من خلال تعلم تقنيات جديدة", categories: ["tech"]},
                        {text: "بواسطة تطوير مهارات قيادية", categories: ["business"]},
                        {text: "بالتركيز على التخصص التعليمي", categories: ["education"]},
                        {text: "من خلال تنمية المواهب الإبداعية", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع المشاريع التي تجذبك أكثر؟",
                    options: [
                        {text: "مشاريع تطوير البرمجيات", categories: ["tech"]},
                        {text: "مشاريع ريادية وتجارية", categories: ["business"]},
                        {text: "مشاريع تعليمية وتدريبية", categories: ["education"]},
                        {text: "مشاريع فنية وإبداعية", categories: ["creative"]}
                    ]
                },
                {
                    text: "كيف تتعامل مع ضغوط العمل؟",
                    options: [
                        {text: "بالتركيز على الحلول التقنية", categories: ["tech"]},
                        {text: "بإدارة الوقت والاستراتيجية", categories: ["business"]},
                        {text: "بالتعاون مع الفريق", categories: ["education"]},
                        {text: "بالابتكار والإبداع", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع التحفيز الذي يدفعك للأمام؟",
                    options: [
                        {text: "حل تحديات تقنية معقدة", categories: ["tech"]},
                        {text: "تحقيق نتائج أعمال ملموسة", categories: ["business"]},
                        {text: "تطوير قدرات الآخرين", categories: ["education"]},
                        {text: "خلق أعمال فنية متميزة", categories: ["creative"]}
                    ]
                },
                {
                    text: "ما هو نوع التفكير الذي تمارسه أكثر؟",
                    options: [
                        {text: "التفكير التحليلي والمنطقي", categories: ["tech"]},
                        {text: "التفكير الاستراتيجي الإداري", categories: ["business"]},
                        {text: "التفكير التربوي والتعليمي", categories: ["education"]},
                        {text: "التفكير الإبداعي والجمالي", categories: ["creative"]}
                    ]
                }
            ],
            jobs: [
                // Tech Jobs
                { name: "مطور برمجيات", category: "tech,analytical", icon: "fa-laptop-code", description: "تطوير البرمجيات والتطبيقات" },
                { name: "محلل بيانات", category: "tech,analytical", icon: "fa-chart-bar", description: "تحليل البيانات وتقديم رؤى" },
                { name: "مهندس شبكات", category: "tech", icon: "fa-network-wired", description: "إدارة وصيانة الشبكات" },
                { name: "مطور ويب", category: "tech,creative", icon: "fa-globe", description: "تصميم وتطوير المواقع الإلكترونية" },
                { name: "مطور تطبيقات", category: "tech", icon: "fa-mobile-alt", description: "تطوير تطبيقات الهواتف الذكية" },
                { name: "أخصائي أمن معلومات", category: "tech,analytical", icon: "fa-shield-alt", description: "حماية الأنظمة والمعلومات" },
                
                // Business Jobs
                { name: "مدير تسويق", category: "business", icon: "fa-bullhorn", description: "إدارة الحملات التسويقية" },
                { name: "مدير مبيعات", category: "business", icon: "fa-hand-holding-usd", description: "قيادة فرق المبيعات" },
                { name: "أخصائي موارد بشرية", category: "business", icon: "fa-users", description: "إدارة الموارد البشرية" },
                { name: "محلل مالي", category: "business,analytical", icon: "fa-chart-pie", description: "تحليل البيانات المالية" },
                { name: "مدير مشاريع", category: "business,management", icon: "fa-tasks", description: "إدارة المشاريع والفرق" },
                
                // Education Jobs
                { name: "معلم", category: "education", icon: "fa-chalkboard-teacher", description: "تعليم الطلاب وتنمية قدراتهم" },
                { name: "مدرب مهني", category: "education", icon: "fa-user-graduate", description: "تدريب الكبار على المهارات" },
                { name: "أخصائي توجيه مهني", category: "education", icon: "fa-hands-helping", description: "توجيه الطلاب مهنياً" },
                { name: "أكاديمي باحث", category: "education,analytical", icon: "fa-microscope", description: "إجراء البحوث الأكاديمية" },
                
                // Creative Jobs
                { name: "مصمم جرافيك", category: "creative", icon: "fa-palette", description: "تصميم المواد البصرية والإعلانية" },
                { name: "مصور فوتوغرافي", category: "creative", icon: "fa-camera", description: "التقاط وتحرير الصور الفوتوغرافية" },
                { name: "كاتب محتوى", category: "creative", icon: "fa-pen-fancy", description: "كتابة المحتوى للمنشورات" },
                { name: "مصمم داخلي", category: "creative", icon: "fa-couch", description: "تصميم المساحات الداخلية" },
                { name: "مخرج فني", category: "creative", icon: "fa-film", description: "إدارة الجوانب الفنية للإنتاج" },
                
                // Other Jobs
                { name: "معالج فيزيائي", category: "healthcare", icon: "fa-wheelchair", description: "علاج الإصابات والمشاكل الحركية" },
                { name: "مهندس إنشاءات", category: "physical", icon: "fa-hard-hat", description: "تصميم وإشراف المشاريع الإنشائية" },
                { name: "أخصائي تسويق رقمي", category: "business,tech", icon: "fa-hashtag", description: "إدارة التسويق عبر الإنترنت" },
                { name: "مدرب شخصي", category: "healthcare", icon: "fa-dumbbell", description: "تدريب الأشخاص على اللياقة البدنية" }
            ]
        };

        // DOM Elements
        const screens = {
            welcome: document.getElementById('welcome-screen'),
            userInfo: document.getElementById('user-info-screen'),
            test: document.getElementById('test-screen'),
            loading: document.getElementById('loading-screen'),
            results: document.getElementById('results-screen')
        };

        // Navigation Functions
        function showScreen(screenName) {
            // Hide all screens
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            
            // Show requested screen
            screens[screenName].classList.remove('hidden');
            state.currentScreen = screenName;
            
            // Special cases
            if (screenName === 'test') {
                updateQuestion();
            }
        }

        function showUserInfo() {
            showScreen('userInfo');
        }

        function startTest() {
            // Validate form
            const form = document.getElementById('user-info-form');
            const inputs = form.querySelectorAll('[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!input.value) {
                    input.classList.add('border-red-500');
                    isValid = false;
                } else {
                    input.classList.remove('border-red-500');
                }
            });
            
            if (!isValid) {
                alert('الرجاء ملء جميع الحقول المطلوبة');
                return;
            }
            
            // Get user info
            state.currentUser = {
                name: document.getElementById('full-name').value,
                age: document.getElementById('age').value,
                dob: document.getElementById('dob').value,
                education: document.getElementById('education').value,
                testCode: document.getElementById('test-code').value
            };
            
            showScreen('test');
        }

        // Test Functions
        function updateQuestion() {
            const question = state.questions[state.currentQuestion];
            document.getElementById('current-question-number').textContent = state.currentQuestion + 1;
            document.getElementById('question-text').textContent = question.text;
            document.getElementById('question-number').textContent = `السؤال ${state.currentQuestion + 1} من ${state.questions.length}`;
            
            // Update progress
            const progress = ((state.currentQuestion) / state.questions.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${Math.round(progress)}%`;
            
            // Update options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option-pill bg-white rounded-xl p-5 cursor-pointer ${state.answers[state.currentQuestion] === index ? 'selected' : ''}`;
                optionElement.onclick = () => selectOption(optionElement, index);
                
                // Determine icon and color based on category
                let iconClass = 'fa-question';
                let bgColor = 'gray';
                if (option.categories.includes('tech')) {
                    iconClass = 'fa-laptop-code';
                    bgColor = 'purple';
                } else if (option.categories.includes('business')) {
                    iconClass = 'fa-chart-line';
                    bgColor = 'blue';
                } else if (option.categories.includes('education')) {
                    iconClass = 'fa-chalkboard-teacher';
                    bgColor = 'green';
                } else if (option.categories.includes('creative')) {
                    iconClass = 'fa-palette';
                    bgColor = 'yellow';
                }
                
                optionElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-${bgColor}-100 text-${bgColor}-600 flex items-center justify-center mr-4">
                            <i class="fas ${iconClass}"></i>
                        </div>
                        <p class="font-medium">${option.text}</p>
                        ${state.answers[state.currentQuestion] === index ? '<i class="fas fa-check text-primary ml-auto"></i>' : ''}
                    </div>
                `;
                optionsContainer.appendChild(optionElement);
            });
        }

        function selectOption(element, optionIndex) {
            // Remove selected class from all options
            document.querySelectorAll('.option-pill').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            
            // Save answer
            state.answers[state.currentQuestion] = optionIndex;
            
            // Track scores for job categories
            const selectedOption = state.questions[state.currentQuestion].options[optionIndex];
            selectedOption.categories.forEach(category => {
                if (!state.scores) state.scores = {};
                state.scores[category] = (state.scores[category] || 0) + 1;
            });
            
            // Auto-advance to next question after a short delay
            setTimeout(() => {
                if (state.currentQuestion < state.questions.length - 1) {
                    state.currentQuestion++;
                    updateQuestion();
                } else {
                    submitTest();
                }
            }, 500);
        }

        function submitTest() {
            showScreen('loading');
            
            // Simulate AI analysis with progress updates
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;
                
                document.getElementById('ai-progress').style.width = `${progress}%`;
                document.getElementById('ai-progress-text').textContent = `${Math.round(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(showResults, 800);
                }
            }, 300);
        }

function showResults() {
  // 1) Build and sort the scored jobs, capping at 100
  const jobMatches = state.jobs
    .map(job => {
      let rawScore = 0;
      job.category.split(',').forEach(cat => {
        rawScore += (state.scores[cat.trim()] || 0) * 5;
      });
      const score = Math.min(rawScore, 100);        // ← clamp here
      return { ...job, score };
    })
    .sort((a, b) => b.score - a.score);

  // 2) Grab the top 3
  const topMatches = jobMatches.slice(0, 3);

  // 3) Your explanations map (unchanged)
  const explanations = {
    tech: "هذا المسار يناسب مهاراتك التحليلية وحبك للتحديات التقنية.…",
    business: "مهاراتك في التواصل والإدارة تجعلك مرشحاً مثالياً…",
    education: "شغفك بالتعليم ومساعدة الآخرين يجعلك مثالياً…",
    creative: "إبداعك وخيالك الواسع يؤهلك للنجاح في المجالات الفنية…",
    healthcare: "اهتمامك بالآخرين ورغبتك في المساعدة تجعلك مناسباً…",
    physical: "مهاراتك العملية وقدرتك على حل المشاكل تجعلك ممتازاً…"
  };

  // 4) Render into the DOM, using job.score (never rawScore)
  const resultsContainer = document.getElementById('results-container');
  resultsContainer.innerHTML = topMatches.map((job, idx) => {
    // pick gradients & icons as before…
    const mainCat = job.category.split(',')[0].trim();
    const bgGradient = idx === 0
      ? 'from-primary to-secondary'
      : idx === 1
        ? 'from-blue-600 to-blue-400'
        : 'from-green-600 to-green-400';
    const textColor = idx === 0
      ? 'primary'
      : idx === 1
        ? 'blue-600'
        : 'green-600';
    const badgeColor = idx === 0 ? 'purple' : idx === 1 ? 'blue' : 'green';

    return `
      <div class="job-card ${idx===0?'top-job':''} bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="flex flex-col md:flex-row">
          <div class="w-full md:w-1/3 bg-gradient-to-br ${bgGradient} p-8 flex flex-col items-center justify-center">
            <div class="w-20 h-20 rounded-2xl bg-white bg-opacity-20 flex items-center justify-center text-white mb-6">
              <i class="fas ${job.icon} text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-white mb-2">${job.name}</h3>
            <p class="text-white text-opacity-80 text-sm">${job.description}</p>
          </div>
          <div class="w-full md:w-2/3 p-8">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 rounded-full bg-${badgeColor}-100 text-${textColor} flex items-center justify-center mr-4">
                <i class="fas ${ idx===0 ? 'fa-bolt' : idx===1 ? 'fa-chart-pie' : 'fa-ad' }"></i>
              </div>
              <div>
                <h4 class="font-bold text-lg">التوافق: <span class="text-${textColor}">${job.score}%</span></h4>
                <p class="text-gray-500 text-sm">
                  ${ idx===0 ? 'أعلى درجة توافق' : idx===1 ? 'بديل ممتاز' : 'خيار جيد' }
                </p>
              </div>
            </div>
            <p class="text-gray-600 mb-6 leading-relaxed">
              ${explanations[mainCat] || "هذا المجال يناسب مهاراتك واهتماماتك بناءً على تحليل إجاباتك."}
            </p>
            <div class="flex flex-wrap gap-2">
              ${job.category.split(',').map(cat => {
                const label = {
                  tech: "التقنية",
                  analytical: "التحليل",
                  business: "الأعمال",
                  management: "الإدارة",
                  education: "التعليم",
                  helping: "المساعدة",
                  creative: "الإبداع",
                  artistic: "الفن",
                  healthcare: "الصحة",
                  physical: "العمل اليدوي"
                }[cat.trim()] || cat.trim();
                return `<span class="px-3 py-1 bg-${badgeColor}-100 text-${textColor} rounded-full text-sm">${label}</span>`;
              }).join('')}
            </div>
          </div>
        </div>
      </div>`;
  }).join('');

  // 5) Finally, show the results screen
  showScreen('results');
}

function restartTest() {
    // Reset state
    state.currentQuestion = 0;
    state.answers = new Array(state.questions.length).fill(null);
    state.scores = {};
    // Show first question again
    updateQuestion();
    showScreen('test');
}
        
  function downloadResults() {
    const { jsPDF } = window.jspdf;
    const resultsContainer = document.getElementById('results-container');
    const downloadBtn = document.getElementById('download-pdf-btn');

    // Hide button before screenshot
    downloadBtn.style.display = 'none';

    setTimeout(() => {
      html2canvas(resultsContainer, {
        scale: 3,
        useCORS: true,
        backgroundColor: '#ffffff'
      }).then(canvas => {
        const ctx = canvas.getContext('2d');
        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imgData.data;

        // Slight brightness correction
        for (let i = 0; i < data.length; i += 4) {
          data[i] = data[i] * 0.95;
          data[i + 1] = data[i + 1] * 0.95;
          data[i + 2] = data[i + 2] * 0.95;
        }

        ctx.putImageData(imgData, 0, 0);

        const image = canvas.toDataURL('image/jpeg', 1.0);
        const pdf = new jsPDF('p', 'mm', 'a4');

        const pageWidth = 210;
        const pageHeight = 297;
        const imgWidth = pageWidth;
        const imgHeight = canvas.height * imgWidth / canvas.width;

        let position = 0;
        let heightLeft = imgHeight;

        pdf.addImage(image, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(image, 'JPEG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }

        // Show button again after generation
        downloadBtn.style.display = 'inline-flex';

        pdf.save('نتائج_اختبار_Smart-Track.pdf');
      }).catch(err => {
        console.error('PDF generation failed:', err);
        alert('حدث خطأ أثناء حفظ النتائج.');
        downloadBtn.style.display = 'inline-flex';
      });
    }, 200);
  }
</script>
</body>
</html>
